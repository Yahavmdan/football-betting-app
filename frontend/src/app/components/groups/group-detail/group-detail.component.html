<div class="container" *ngIf="group">
  <button class="back-btn" routerLink="/groups">‚Üê {{ 'groups.backToGroups' | translate }}</button>

  <div class="group-header">
    <div class="group-header-top">
      <h1>{{ group.name }}</h1>
      <div class="group-actions">
        <button *ngIf="canManageGroup()" (click)="openEditGroup()" class="btn-edit-group">
          {{ 'common.edit' | translate }}
        </button>
        <button *ngIf="canManageGroup()" (click)="confirmDeleteGroup()" class="btn-delete-group">
          {{ 'common.delete' | translate }}
        </button>
        <button *ngIf="!isGroupCreator() && !authService.isAdmin()" (click)="confirmLeaveGroup()" class="btn-leave-group">
          {{ 'groups.leaveGroup' | translate }}
        </button>
      </div>
    </div>
    <p class="description">{{ group.description || ('groups.noDescription' | translate) }}</p>
    <div class="invite-info">
      <span>{{ 'groups.inviteCode' | translate }}: <strong class="invite-code">{{ group.inviteCode }}</strong></span>
      <span class="member-count">{{ group.members.length }} {{ 'groups.members' | translate }}</span>
    </div>

    <!-- Edit Group Form -->
    <div *ngIf="editingGroup" class="edit-group-form">
      <h3>{{ 'groups.editGroup' | translate }}</h3>
      <div class="form-group">
        <label>{{ 'groups.groupName' | translate }}</label>
        <input type="text" [(ngModel)]="editGroupData.name" class="form-control">
      </div>
      <div class="form-group">
        <label>{{ 'groups.description' | translate }}</label>
        <textarea [(ngModel)]="editGroupData.description" class="form-control" rows="3"></textarea>
      </div>
      <div class="button-row">
        <button (click)="submitEditGroup()" [disabled]="loadingEditGroup" class="btn-primary btn-small">
          {{ loadingEditGroup ? ('auth.loading' | translate) : ('common.save' | translate) }}
        </button>
        <button (click)="cancelEditGroup()" class="btn-secondary btn-small">
          {{ 'groups.cancel' | translate }}
        </button>
      </div>
      <div *ngIf="editGroupError" class="error-message">{{ editGroupError }}</div>
    </div>

    <!-- Delete Group Confirmation -->
    <div *ngIf="deletingGroup" class="delete-confirm">
      <p>{{ 'groups.confirmDelete' | translate }}</p>
      <div class="button-row">
        <button (click)="deleteGroup()" [disabled]="loadingDeleteGroup" class="btn-delete-group btn-small">
          {{ loadingDeleteGroup ? ('auth.loading' | translate) : ('common.delete' | translate) }}
        </button>
        <button (click)="cancelDeleteGroup()" class="btn-secondary btn-small">
          {{ 'groups.cancel' | translate }}
        </button>
      </div>
    </div>

    <!-- Leave Group Confirmation -->
    <div *ngIf="leavingGroup" class="leave-confirm">
      <p>{{ 'groups.confirmLeave' | translate }}</p>
      <div class="button-row">
        <button (click)="leaveGroup()" [disabled]="loadingLeaveGroup" class="btn-leave-group btn-small">
          {{ loadingLeaveGroup ? ('auth.loading' | translate) : ('groups.leaveGroup' | translate) }}
        </button>
        <button (click)="cancelLeaveGroup()" class="btn-secondary btn-small">
          {{ 'groups.cancel' | translate }}
        </button>
      </div>
    </div>
  </div>

  <div class="content-grid">
    <div class="leaderboard-section">
      <h2>{{ 'groups.leaderboard' | translate }}</h2>
      <div *ngIf="loadingLeaderboard" class="loading">{{ 'auth.loading' | translate }}</div>
      <div *ngIf="!loadingLeaderboard && leaderboard.length > 0" class="leaderboard">
        <div *ngFor="let member of leaderboard; let i = index" class="leaderboard-item"
             [class.winner]="isWinner(member)"
             [class.eliminated]="isEliminated(member)">
          <span class="rank">{{ i + 1 }}</span>
          <div class="profile-picture-wrapper" (click)="openProfilePicture(member.user)">
            <img
              *ngIf="member.user.profilePicture"
              [src]="getProfilePictureUrl(member.user.profilePicture)"
              alt=""
              class="leaderboard-profile-picture"
              (error)="onProfileImageError($event)"
            />
            <span *ngIf="!member.user.profilePicture" class="leaderboard-profile-placeholder">
              {{ member.user.username.charAt(0).toUpperCase() }}
            </span>
            <span class="online-indicator" [class.online]="isUserOnline(member.user.lastActive)"></span>
          </div>
          <span class="username">
            {{ member.user.username }}
            <span *ngIf="isWinner(member)" class="trophy">üèÜ</span>
            <span *ngIf="isEliminated(member)" class="status-label">({{ 'groups.eliminated' | translate }})</span>
          </span>
          <span class="points">
            {{ member.points }}
          </span>
          <button
            *ngIf="canManageGroup() && !isGroupCreatorMember(member.user._id)"
            (click)="confirmKickMember(member.user._id)"
            class="btn-kick"
            [title]="'groups.kickMember' | translate">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <!-- Kick confirmation -->
        <div *ngIf="kickingMemberId" class="kick-confirm">
          <p>{{ 'groups.confirmKick' | translate }}</p>
          <div class="button-row">
            <button (click)="kickMember(kickingMemberId)" [disabled]="loadingKickMember" class="btn-delete-group btn-small">
              {{ loadingKickMember ? ('auth.loading' | translate) : ('groups.kick' | translate) }}
            </button>
            <button (click)="cancelKickMember()" class="btn-secondary btn-small">
              {{ 'groups.cancel' | translate }}
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="!loadingLeaderboard && leaderboard.length === 0" class="empty-state">
        {{ 'groups.noMembers' | translate }}
      </div>

      <!-- Pending Members in Leaderboard (shown to admin/creator) -->
      <div *ngIf="canManageGroup() && pendingMembers.length > 0" class="pending-in-leaderboard">
        <div *ngFor="let pending of pendingMembers" class="leaderboard-item pending">
          <span class="rank">-</span>
          <div class="profile-picture-wrapper" (click)="openProfilePicture(pending.user)">
            <img
              *ngIf="pending.user.profilePicture"
              [src]="getProfilePictureUrl(pending.user.profilePicture)"
              alt=""
              class="leaderboard-profile-picture"
              (error)="onProfileImageError($event)"
            />
            <span *ngIf="!pending.user.profilePicture" class="leaderboard-profile-placeholder">
              {{ pending.user.username.charAt(0).toUpperCase() }}
            </span>
            <span class="online-indicator" [class.online]="isUserOnline(pending.user.lastActive)"></span>
          </div>
          <span class="username">
            {{ pending.user.username }}
          </span>
          <div class="pending-actions">
            <button (click)="approveMember(pending.user._id)" class="btn-approve" [title]="'groups.approve' | translate">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </button>
            <button (click)="rejectMember(pending.user._id)" class="btn-reject" [title]="'groups.reject' | translate">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="matches-section">
      <div class="section-header">
        <h2>{{ 'groups.matches' | translate }} <span class="match-count">({{ filteredMatches.length }})</span></h2>
        <div class="header-actions">
          <label class="save-filter-checkbox" [title]="'filters.saveFiltersTooltip' | translate">
            <input type="checkbox" [(ngModel)]="saveFiltersEnabled" (change)="onSaveFiltersToggle()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
          </label>
          <button (click)="openFilterDialog()" class="btn-filter" [class.has-filters]="hasActiveFilters()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
            {{ 'filters.filter' | translate }}
            <span *ngIf="hasActiveFilters()" class="filter-count">{{ getActiveFilterCount() }}</span>
          </button>
          <button
            *ngIf="canManageGroup()"
            [routerLink]="['/matches/manage']"
            [queryParams]="{groupId: groupId}"
            class="btn-manage"
          >
            {{ 'matches.manageMatches' | translate }}
          </button>
        </div>
      </div>

      <!-- Filter Dialog Overlay -->
      <div *ngIf="showFilterDialog" class="filter-overlay" (click)="closeFilterDialog()">
        <div class="filter-dialog" (click)="$event.stopPropagation()">
          <div class="filter-header">
            <h3>{{ 'filters.filterMatches' | translate }}</h3>
            <button (click)="closeFilterDialog()" class="btn-close-filter">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>

          <div class="filter-body">
            <!-- Status Filter -->
            <div class="filter-section">
              <label class="filter-label">{{ 'filters.matchStatus' | translate }}</label>
              <div class="checkbox-group">
                <label class="checkbox-item">
                  <input type="checkbox" [(ngModel)]="filters.showFinished">
                  <span>{{ 'filters.finished' | translate }}</span>
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" [(ngModel)]="filters.showNotStarted">
                  <span>{{ 'filters.notStarted' | translate }}</span>
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" [(ngModel)]="filters.showOngoing">
                  <span>{{ 'filters.ongoing' | translate }}</span>
                </label>
              </div>
            </div>

            <!-- Date Range Filter -->
            <div class="filter-section">
              <label class="filter-label">{{ 'filters.dateRange' | translate }}</label>
              <div class="date-range">
                <input type="date" [(ngModel)]="filters.dateFrom" class="form-control">
                <span class="date-separator">-</span>
                <input type="date" [(ngModel)]="filters.dateTo" class="form-control">
              </div>
            </div>

            <!-- Members Who Betted Filter -->
            <div class="filter-section">
              <label class="filter-label">{{ 'filters.membersBetted' | translate }}</label>
              <app-select
                [options]="memberSelectOptions"
                [(ngModel)]="filters.selectedMembers"
                [multiple]="true"
                placeholder="Select members"
                placeholderHe="◊ë◊ó◊® ◊û◊©◊™◊û◊©◊ô◊ù"
                selectedText="selected"
                selectedTextHe="◊†◊ë◊ó◊®◊ï">
              </app-select>
            </div>

            <!-- Teams Filter -->
            <div class="filter-section">
              <label class="filter-label">{{ 'filters.teams' | translate }}</label>
              <app-select
                [options]="teamSelectOptions"
                [(ngModel)]="filters.selectedTeams"
                [multiple]="true"
                [searchable]="true"
                placeholder="Select teams"
                placeholderHe="◊ë◊ó◊® ◊ß◊ë◊ï◊¶◊ï◊™"
                searchPlaceholder="Search teams..."
                searchPlaceholderHe="◊ó◊ô◊§◊ï◊© ◊ß◊ë◊ï◊¶◊ï◊™..."
                selectedText="selected"
                selectedTextHe="◊†◊ë◊ó◊®◊ï">
              </app-select>
            </div>

            <!-- Score Filter (for finished matches) -->
            <div class="filter-section">
              <label class="filter-label">{{ 'filters.score' | translate }}</label>
              <div class="score-filter">
                <div class="score-input-group">
                  <label>{{ 'filters.homeScore' | translate }}</label>
                  <input type="number" [(ngModel)]="filters.homeScore" min="0" class="form-control score-input" [placeholder]="'filters.any' | translate">
                </div>
                <span class="score-separator">-</span>
                <div class="score-input-group">
                  <label>{{ 'filters.awayScore' | translate }}</label>
                  <input type="number" [(ngModel)]="filters.awayScore" min="0" class="form-control score-input" [placeholder]="'filters.any' | translate">
                </div>
              </div>
            </div>
          </div>

          <div class="filter-footer">
            <button (click)="clearFilters()" class="btn-secondary">{{ 'filters.clearAll' | translate }}</button>
            <button (click)="applyFilters()" class="btn-primary">{{ 'filters.apply' | translate }}</button>
          </div>
        </div>
      </div>
      <div *ngIf="loadingMatches" class="loading">{{ 'auth.loading' | translate }}</div>
      <div *ngIf="!loadingMatches && filteredMatches.length > 0" class="matches-list">
        <div *ngFor="let match of filteredMatches" class="match-card compact" [class.has-bet]="hasBetOnMatch(match._id)" [class.expanded]="expandedMatchId === match._id">
          <!-- Compact view - always visible -->
          <div class="match-compact-row" (click)="toggleMatchExpand(match._id)">
            <div class="match-compact-teams">
              <span class="team-name">{{ match.homeTeam | teamTranslate }}</span>
              <img *ngIf="getTeamLogo(match.homeTeam)" [src]="getTeamLogo(match.homeTeam)" [alt]="match.homeTeam | teamTranslate" class="team-logo-small" (error)="onImageError($event)">
              <span *ngIf="match.status === 'FINISHED' || (match.result && match.result.homeScore !== null)" class="score-inline">{{ match.result.homeScore }}</span>
              <span class="vs-compact">-</span>
              <span *ngIf="match.status === 'FINISHED' || (match.result && match.result.awayScore !== null)" class="score-inline">{{ match.result.awayScore }}</span>
              <img *ngIf="getTeamLogo(match.awayTeam)" [src]="getTeamLogo(match.awayTeam)" [alt]="match.awayTeam | teamTranslate" class="team-logo-small" (error)="onImageError($event)">
              <span class="team-name">{{ match.awayTeam | teamTranslate }}</span>
            </div>
            <div class="match-compact-info">
              <span class="date-compact">{{ match.matchDate | date:'dd/MM HH:mm' }}</span>
              <span class="status-compact" [class.finished]="match.status === 'FINISHED'" [class.started]="match.status === 'SCHEDULED' && isMatchInPast(match.matchDate)">
                {{ (match.status === 'SCHEDULED' && isMatchInPast(match.matchDate)) ? ('matches.started' | translate) : ('matches.' + match.status.toLowerCase() | translate) }}
              </span>
              <span *ngIf="hasBetOnMatch(match._id)" class="bet-indicator">‚úì</span>
              <button class="btn-expand" [class.expanded]="expandedMatchId === match._id">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
            </div>
          </div>

          <!-- Expanded view - animated expand/collapse -->
          <div class="match-expanded-wrapper" [class.expanded]="expandedMatchId === match._id">
          <div class="match-expanded-content">
            <!-- Team logo backgrounds -->
            <div class="match-bg-logos">
              <div class="bg-logo bg-logo-home" *ngIf="getTeamLogo(match.homeTeam)" [style.background-image]="'url(' + getTeamLogo(match.homeTeam) + ')'"></div>
              <div class="bg-logo bg-logo-away" *ngIf="getTeamLogo(match.awayTeam)" [style.background-image]="'url(' + getTeamLogo(match.awayTeam) + ')'"></div>
            </div>
            <div class="match-expanded-header">
              <span class="competition">{{ match.competition }}</span>
            </div>
            <div class="match-actions-row">
              <button
                *ngIf="group?.showBets || isMatchInPast(match.matchDate)"
                (click)="toggleMemberBets(match._id); $event.stopPropagation()"
                class="btn-action"
                [class.active]="viewingBetsForMatch === match._id">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                {{ 'bets.viewGroupBets' | translate }}
              </button>
              <button
                (click)="openInlineBetForm(match); $event.stopPropagation()"
                class="btn-action btn-primary-action"
                *ngIf="match.status === 'SCHEDULED' && !isMatchInPast(match.matchDate)"
                [class.active]="placingBetForMatch === match._id">
                {{ hasBetOnMatch(match._id) ? ('bets.editBet' | translate) : ('matches.placeBet' | translate) }}
              </button>
              <span *ngIf="isMatchInPast(match.matchDate) && match.status === 'SCHEDULED' && !canManageGroup()" class="past-match-label">
                {{ 'matches.matchStartedLabel' | translate }}
              </span>
              <button
                *ngIf="canManageGroup() && canUpdateScore(match)"
                (click)="openScoreUpdate(match); $event.stopPropagation()"
                class="btn-action">
                {{ 'matches.updateScore' | translate }}
              </button>
              <button
                *ngIf="canManageGroup() && match.status === 'SCHEDULED' && match.result && match.result.homeScore !== null"
                (click)="markAsFinished(match._id); $event.stopPropagation()"
                class="btn-action btn-finish">
                {{ 'matches.markAsFinished' | translate }}
              </button>
            </div>
            <!-- Head-to-Head History -->
            <div class="head-to-head-section">
              <h4 class="h2h-title">{{ 'matches.headToHead' | translate }}</h4>
              <div *ngIf="loadingHeadToHead" class="h2h-loading">{{ 'auth.loading' | translate }}</div>
              <div *ngIf="!loadingHeadToHead && headToHeadMatches.length === 0" class="h2h-empty">
                {{ 'matches.noHeadToHead' | translate }}
              </div>
              <div *ngIf="!loadingHeadToHead && headToHeadMatches.length > 0" class="h2h-list">
                <div *ngFor="let h2hMatch of headToHeadMatches" class="h2h-item">
                  <span class="h2h-date">{{ h2hMatch.matchDate | date:'dd/MM/yy' }}</span>
                  <div class="h2h-teams">
                    <span class="h2h-team" [class.winner]="(h2hMatch.result?.homeScore ?? 0) > (h2hMatch.result?.awayScore ?? 0)">{{ h2hMatch.homeTeam | teamTranslate }}</span>
                    <span class="h2h-score">{{ h2hMatch.result?.homeScore }} - {{ h2hMatch.result?.awayScore }}</span>
                    <span class="h2h-team" [class.winner]="(h2hMatch.result?.awayScore ?? 0) > (h2hMatch.result?.homeScore ?? 0)">{{ h2hMatch.awayTeam | teamTranslate }}</span>
                  </div>
                </div>
              </div>
            </div>
            <!-- Team Form Section -->
            <div class="team-form-section">
              <h4 class="team-form-title">{{ 'matches.teamForm' | translate }}</h4>
              <div *ngIf="loadingTeamForm" class="team-form-loading">{{ 'auth.loading' | translate }}</div>
              <div *ngIf="!loadingTeamForm" class="team-form-container">
                <!-- Home Team Form -->
                <div class="team-form-column">
                  <div class="team-form-header">
                    <img *ngIf="getTeamLogo(match.homeTeam)" [src]="getTeamLogo(match.homeTeam)" class="team-form-logo" (error)="onImageError($event)">
                    <span class="team-form-name">{{ match.homeTeam | teamTranslate }}</span>
                  </div>
                  <div *ngIf="homeTeamRecentMatches.length === 0" class="team-form-empty">
                    {{ 'matches.noRecentMatches' | translate }}
                  </div>
                  <div *ngIf="homeTeamRecentMatches.length > 0" class="team-form-results">
                    <span *ngFor="let formMatch of homeTeamRecentMatches"
                          class="form-result"
                          [class.win]="getTeamResult(formMatch, match.homeTeam) === 'W'"
                          [class.draw]="getTeamResult(formMatch, match.homeTeam) === 'D'"
                          [class.loss]="getTeamResult(formMatch, match.homeTeam) === 'L'"
                          [title]="(formMatch.homeTeam | teamTranslate) + ' ' + formMatch.result?.homeScore + '-' + formMatch.result?.awayScore + ' ' + (formMatch.awayTeam | teamTranslate)">
                      {{ getTeamResult(formMatch, match.homeTeam) }}
                    </span>
                  </div>
                </div>
                <!-- Away Team Form -->
                <div class="team-form-column">
                  <div class="team-form-header">
                    <img *ngIf="getTeamLogo(match.awayTeam)" [src]="getTeamLogo(match.awayTeam)" class="team-form-logo" (error)="onImageError($event)">
                    <span class="team-form-name">{{ match.awayTeam | teamTranslate }}</span>
                  </div>
                  <div *ngIf="awayTeamRecentMatches.length === 0" class="team-form-empty">
                    {{ 'matches.noRecentMatches' | translate }}
                  </div>
                  <div *ngIf="awayTeamRecentMatches.length > 0" class="team-form-results">
                    <span *ngFor="let formMatch of awayTeamRecentMatches"
                          class="form-result"
                          [class.win]="getTeamResult(formMatch, match.awayTeam) === 'W'"
                          [class.draw]="getTeamResult(formMatch, match.awayTeam) === 'D'"
                          [class.loss]="getTeamResult(formMatch, match.awayTeam) === 'L'"
                          [title]="(formMatch.homeTeam | teamTranslate) + ' ' + formMatch.result?.homeScore + '-' + formMatch.result?.awayScore + ' ' + (formMatch.awayTeam | teamTranslate)">
                      {{ getTeamResult(formMatch, match.awayTeam) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          <!-- Member Bets Panel -->
          <div *ngIf="viewingBetsForMatch === match._id" class="member-bets-panel">
            <div class="member-bets-header">
              <h4>{{ 'bets.memberBets' | translate }}</h4>
              <button (click)="closeMemberBets()" class="btn-close-bets">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div *ngIf="loadingMemberBets" class="loading-bets">{{ 'auth.loading' | translate }}</div>
            <div *ngIf="!loadingMemberBets && memberBets.length > 0" class="member-bets-list">
              <div *ngFor="let memberBet of memberBets" class="member-bet-item">
                <span class="member-name">{{ memberBet.user.username }}</span>
                <span *ngIf="memberBet.hasBet" class="bet-time">{{ memberBet.bet?.createdAt | date:'dd/MM/yy, HH:mm' }}</span>
                <div class="bet-info">
                  <span *ngIf="memberBet.hasBet" class="bet-outcome" [class.home]="memberBet.bet?.outcome === '1'" [class.draw]="memberBet.bet?.outcome === 'X'" [class.away]="memberBet.bet?.outcome === '2'">
                    {{ memberBet.bet?.outcome === '1' ? (match.homeTeam | teamTranslate) : (memberBet.bet?.outcome === '2' ? (match.awayTeam | teamTranslate) : ('bets.draw' | translate)) }}
                  </span>
                  <span *ngIf="memberBet.hasBet && group?.betType === 'relative' && memberBet.bet?.wagerAmount" class="bet-wager">
                    {{ memberBet.bet?.wagerAmount }} {{ 'groups.credits' | translate }}
                  </span>
                  <span *ngIf="!memberBet.hasBet" class="no-bet">{{ 'bets.noBet' | translate }}</span>
                </div>
              </div>
            </div>
            <div *ngIf="!loadingMemberBets && memberBets.length === 0" class="empty-bets">
              {{ 'groups.noMembers' | translate }}
            </div>
          </div>
          <!-- Score update form -->
          <div *ngIf="editingMatchId === match._id" class="score-update-form">
            <div class="score-form-row">
              <div class="score-form-group">
                <label>{{ match.homeTeam | teamTranslate }}</label>
                <input
                  type="number"
                  [(ngModel)]="updateScoreData.homeScore"
                  class="score-input"
                  min="0">
              </div>
              <div class="score-form-group">
                <label>{{ match.awayTeam | teamTranslate }}</label>
                <input
                  type="number"
                  [(ngModel)]="updateScoreData.awayScore"
                  class="score-input"
                  min="0">
              </div>
            </div>
            <div class="score-button-row">
              <button
                (click)="submitScoreUpdate(match._id)"
                [disabled]="loadingScoreUpdate || updateScoreData.homeScore === null || updateScoreData.awayScore === null"
                class="btn-primary btn-small">
                {{ loadingScoreUpdate ? ('auth.loading' | translate) : ('matches.saveScore' | translate) }}
              </button>
              <button (click)="cancelScoreUpdate()" class="btn-secondary btn-small">
                {{ 'groups.cancel' | translate }}
              </button>
            </div>
            <div *ngIf="scoreUpdateError" class="error-message">{{ scoreUpdateError }}</div>
          </div>

          <!-- Inline Bet Form Panel -->
          <div *ngIf="placingBetForMatch === match._id" class="inline-bet-panel">
            <div class="inline-bet-header">
              <h4>{{ inlineExistingBet ? ('bets.yourBet' | translate) : ('bets.placeYourBet' | translate) }}</h4>
              <button (click)="closeInlineBetForm()" class="btn-close-bet">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>

            <!-- Existing bet info -->
            <div *ngIf="inlineExistingBet" class="inline-bet-info-message">
              ‚ÑπÔ∏è {{ 'bets.canUpdateBet' | translate }}
            </div>

            <!-- Outcome buttons -->
            <div class="inline-bet-section">
              <label class="inline-bet-label">{{ 'bets.matchResult' | translate }}</label>
              <div class="inline-outcome-buttons">
                <button
                  type="button"
                  class="inline-outcome-btn"
                  [class.selected]="inlineBetData.outcome === '1'"
                  (click)="selectInlineOutcome('1')">
                  <img *ngIf="getTeamLogo(match.homeTeam)" [src]="getTeamLogo(match.homeTeam)" class="inline-outcome-logo" (error)="onImageError($event)">
                  <span class="inline-outcome-number">1</span>
                  <span class="inline-outcome-name">{{ match.homeTeam | teamTranslate }}</span>
                </button>
                <button
                  type="button"
                  class="inline-outcome-btn"
                  [class.selected]="inlineBetData.outcome === 'X'"
                  (click)="selectInlineOutcome('X')">
                  <span class="inline-outcome-number">X</span>
                  <span class="inline-outcome-name">{{ 'bets.draw' | translate }}</span>
                </button>
                <button
                  type="button"
                  class="inline-outcome-btn"
                  [class.selected]="inlineBetData.outcome === '2'"
                  (click)="selectInlineOutcome('2')">
                  <img *ngIf="getTeamLogo(match.awayTeam)" [src]="getTeamLogo(match.awayTeam)" class="inline-outcome-logo" (error)="onImageError($event)">
                  <span class="inline-outcome-number">2</span>
                  <span class="inline-outcome-name">{{ match.awayTeam | teamTranslate }}</span>
                </button>
              </div>
            </div>

            <!-- Points info for relative betting -->
            <div *ngIf="getMatchRelativePoints(match)" class="inline-points-info">
              <label class="inline-bet-label">{{ 'bets.pointsSystem' | translate }}</label>
              <div class="inline-points-grid">
                <div class="inline-points-item">
                  <span>{{ match.homeTeam | teamTranslate }} (1)</span>
                  <span class="inline-points-value">{{ getMatchRelativePoints(match)?.homeWin }}x</span>
                </div>
                <div class="inline-points-item">
                  <span>{{ 'bets.draw' | translate }} (X)</span>
                  <span class="inline-points-value">{{ getMatchRelativePoints(match)?.draw }}x</span>
                </div>
                <div class="inline-points-item">
                  <span>{{ match.awayTeam | teamTranslate }} (2)</span>
                  <span class="inline-points-value">{{ getMatchRelativePoints(match)?.awayWin }}x</span>
                </div>
              </div>
            </div>

            <!-- Wager section for relative betting -->
            <div *ngIf="group?.betType === 'relative'" class="inline-wager-section">
              <label class="inline-bet-label">{{ 'bets.wager' | translate }}</label>
              <div class="inline-credits-display">
                <span>{{ 'bets.availableCredits' | translate }}:</span>
                <span class="inline-credits-value">{{ inlineEffectiveCredits }}</span>
              </div>
              <div class="inline-wager-input-group">
                <input
                  type="number"
                  [(ngModel)]="inlineWagerAmount"
                  min="1"
                  [max]="inlineEffectiveCredits"
                  step="1"
                  class="inline-wager-input"
                  [placeholder]="'bets.enterWagerAmount' | translate"
                  [disabled]="inlineEffectiveCredits <= 0">
              </div>
              <div *ngIf="inlineWagerAmount && inlineBetData.outcome && getMatchRelativePoints(match)" class="inline-potential-win">
                <span>{{ 'bets.potentialWin' | translate }}:</span>
                <span class="inline-potential-value">{{ calculateInlinePotentialWin(match) }} {{ 'groups.credits' | translate }}</span>
              </div>
              <div *ngIf="inlineEffectiveCredits <= 0" class="inline-error-message">
                {{ 'groups.eliminated' | translate }} - {{ 'bets.insufficientCredits' | translate }}
              </div>
            </div>

            <!-- Error and success messages -->
            <div *ngIf="inlineBetError" class="inline-error-message">{{ inlineBetError }}</div>
            <div *ngIf="inlineBetSuccess" class="inline-success-message">{{ inlineBetSuccess }}</div>

            <!-- Submit button -->
            <div class="inline-bet-actions">
              <button (click)="closeInlineBetForm()" class="btn-secondary btn-small">
                {{ 'groups.cancel' | translate }}
              </button>
              <button
                (click)="submitInlineBet()"
                [disabled]="!inlineBetData.outcome || inlineLoadingBet || (group.betType === 'relative' && (!inlineWagerAmount || inlineEffectiveCredits <= 0))"
                class="btn-primary btn-small">
                {{ inlineLoadingBet ? ('bets.placingBet' | translate) : (inlineExistingBet ? ('bets.updateBet' | translate) : ('matches.placeBet' | translate)) }}
              </button>
            </div>
          </div>
          </div> <!-- Close match-expanded-content -->
          </div> <!-- Close match-expanded-wrapper -->
        </div>
      </div>
      <div *ngIf="!loadingMatches && filteredMatches.length === 0" class="empty-state">
        {{ hasActiveFilters() ? ('filters.noMatchesFound' | translate) : ('groups.noMatches' | translate) }}
      </div>
    </div>
  </div>

  <!-- Profile Picture Modal -->
  <div *ngIf="viewingProfilePicture" class="profile-picture-modal" (click)="closeProfilePicture()">
    <div class="profile-picture-modal-content" (click)="$event.stopPropagation()">
      <button class="close-modal-btn" (click)="closeProfilePicture()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <img
        *ngIf="viewingProfilePicture.profilePicture"
        [src]="getProfilePictureUrl(viewingProfilePicture.profilePicture)"
        [alt]="viewingProfilePicture.username"
        class="modal-profile-picture"
      />
      <div *ngIf="!viewingProfilePicture.profilePicture" class="modal-profile-placeholder">
        {{ viewingProfilePicture.username.charAt(0).toUpperCase() }}
      </div>
      <div class="modal-username">
        {{ viewingProfilePicture.username }}
        <span class="modal-online-status" [class.online]="isUserOnline(viewingProfilePicture.lastActive)">
          {{ isUserOnline(viewingProfilePicture.lastActive) ? 'Online' : 'Offline' }}
        </span>
      </div>
    </div>
  </div>
</div>
