<div class="container" *ngIf="group">
    <button class="back-btn" routerLink="/groups">‚Üê {{ 'groups.backToGroups' | translate }}</button>

    <div class="group-header">
        <div class="group-header-top">
            <div class="group-title-row">
                <h1>{{ group.name }}</h1>
                <span class="member-count">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    {{ group.members.length }} {{ 'groups.members' | translate }}
                </span>
            </div>
            <div class="group-menu-wrapper">
                <button class="btn-group-menu" (click)="showGroupMenu = !showGroupMenu; $event.stopPropagation()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="currentColor">
                        <circle cx="12" cy="5" r="2"></circle>
                        <circle cx="12" cy="12" r="2"></circle>
                        <circle cx="12" cy="19" r="2"></circle>
                    </svg>
                </button>
                <div class="group-menu-dropdown" *ngIf="showGroupMenu" (click)="showGroupMenu = false">
                    <button *ngIf="canManageGroup()" (click)="openEditGroup()" class="group-menu-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        {{ 'common.edit' | translate }}
                    </button>
                    <button *ngIf="canManageGroup()" (click)="confirmDeleteGroup()"
                        class="group-menu-item group-menu-item-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                            </path>
                        </svg>
                        {{ 'common.delete' | translate }}
                    </button>
                    <button *ngIf="!isGroupCreator() && !authService.isAdmin()" (click)="confirmLeaveGroup()"
                        class="group-menu-item group-menu-item-warning">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        {{ 'groups.leaveGroup' | translate }}
                    </button>
                </div>
            </div>
        </div>
        <p *ngIf="group.description" class="description">{{ group.description }}</p>
        <div class="group-toolbar">
            <span class="invite-code-container">
                <button class="btn-copy-link" (click)="copyJoinLink()" [title]="'groups.shareLink' | translate">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                    {{ 'groups.invite' | translate }}
                </button>
            </span>
            <div *ngIf="isAutomaticGroup()" class="group-toolbar-league">
                <button class="btn-standings" (click)="toggleStandings()" [class.active]="showStandings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    {{ 'standings.leagueTable' | translate }}
                </button>
                <button class="btn-sync" (click)="syncMatches()" [disabled]="syncingMatches">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        [class.spinning]="syncingMatches">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                    </svg>
                    {{ syncingMatches ? ('groups.syncingMatches' | translate) : ('groups.syncMatches' | translate) }}
                </button>
            </div>
        </div>

        <!-- League Standings Modal Overlay -->
        <div *ngIf="showStandings && isAutomaticGroup()" class="standings-overlay" (click)="toggleStandings()">
            <div class="standings-modal" (click)="$event.stopPropagation()">
                <div class="standings-header">
                    <div class="standings-title">
                        <img *ngIf="leagueStandings?.league?.logo" [src]="leagueStandings?.league?.logo"
                            class="league-logo" alt="">
                        <h3>{{ leagueStandings?.league?.name || ('standings.leagueTable' | translate) }}</h3>
                        <span *ngIf="leagueStandings?.league?.season" class="season-badge">{{
                            leagueStandings?.league?.season }}
                            /{{ (leagueStandings?.league?.season || 0) + 1 }}</span>
                    </div>
                    <button class="btn-close-standings" (click)="toggleStandings()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <div *ngIf="loadingStandings" class="standings-loading">
                    <div class="inline-spinner"></div>
                </div>

                <div *ngIf="standingsError" class="standings-error">
                    {{ standingsError }}
                </div>

                <div *ngIf="!loadingStandings && !standingsError && leagueStandings" class="standings-table-wrapper">
                    <table class="standings-table">
                        <thead>
                            <tr>
                                <th class="col-rank">#</th>
                                <th class="col-team">{{ 'standings.team' | translate }}</th>
                                <th class="col-played">{{ 'standings.played' | translate }}</th>
                                <th class="col-won">{{ 'standings.won' | translate }}</th>
                                <th class="col-drawn">{{ 'standings.drawn' | translate }}</th>
                                <th class="col-lost">{{ 'standings.lost' | translate }}</th>
                                <th class="col-gf">{{ 'standings.gf' | translate }}</th>
                                <th class="col-ga">{{ 'standings.ga' | translate }}</th>
                                <th class="col-gd">{{ 'standings.gd' | translate }}</th>
                                <th class="col-points">{{ 'standings.pts' | translate }}</th>
                                <th class="col-form">{{ 'standings.form' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let team of leagueStandings.standings"
                                [class.champions-league]="team.description?.includes('Champions')"
                                [class.europa-league]="team.description?.includes('Europa') || team.description?.includes('Confederation')"
                                [class.relegation]="team.description?.includes('Relegation')">
                                <td class="col-rank">{{ team.rank }}</td>
                                <td class="col-team">
                                    <img [src]="team.team.logo" [alt]="team.team.name | teamTranslate"
                                        class="team-logo-tiny">
                                    <span class="team-name">{{ team.team.name | teamTranslate }}</span>
                                </td>
                                <td class="col-played">{{ team.played }}</td>
                                <td class="col-won">{{ team.won }}</td>
                                <td class="col-drawn">{{ team.drawn }}</td>
                                <td class="col-lost">{{ team.lost }}</td>
                                <td class="col-gf">{{ team.goalsFor }}</td>
                                <td class="col-ga">{{ team.goalsAgainst }}</td>
                                <td class="col-gd" [class.positive]="team.goalsDiff > 0"
                                    [class.negative]="team.goalsDiff < 0">{{ team.goalsDiff > 0 ? '+' : '' }}{{
                                    team.goalsDiff }}
                                </td>
                                <td class="col-points"><strong>{{ team.points }}</strong></td>
                                <td class="col-form">
                                    <div class="form-badges">
                                        <span *ngFor="let result of team.form.split('')" class="form-badge"
                                            [class.win]="result === 'W'" [class.draw]="result === 'D'"
                                            [class.loss]="result === 'L'">{{ result }}</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Edit Group Form -->
        <div *ngIf="editingGroup" class="edit-group-form">
            <h3>{{ 'groups.editGroup' | translate }}</h3>
            <div class="form-group">
                <label>{{ 'groups.groupName' | translate }}</label>
                <input type="text" [(ngModel)]="editGroupData.name" class="form-control">
            </div>
            <div class="form-group">
                <label>{{ 'groups.description' | translate }}</label>
                <textarea [(ngModel)]="editGroupData.description" class="form-control" rows="3"></textarea>
            </div>
            <div class="button-row">
                <button (click)="submitEditGroup()" [disabled]="loadingEditGroup" class="btn-primary btn-small">
                    {{ loadingEditGroup ? ('auth.loading' | translate) : ('common.save' | translate) }}
                </button>
                <button (click)="cancelEditGroup()" class="btn-secondary btn-small">
                    {{ 'groups.cancel' | translate }}
                </button>
            </div>
        </div>

        <!-- Delete Group Confirmation -->
        <div *ngIf="deletingGroup" class="delete-confirm">
            <p>{{ 'groups.confirmDelete' | translate }}</p>
            <div class="button-row">
                <button (click)="deleteGroup()" [disabled]="loadingDeleteGroup" class="btn-delete-group btn-small">
                    {{ loadingDeleteGroup ? ('auth.loading' | translate) : ('common.delete' | translate) }}
                </button>
                <button (click)="cancelDeleteGroup()" class="btn-secondary btn-small">
                    {{ 'groups.cancel' | translate }}
                </button>
            </div>
        </div>

        <!-- Leave Group Confirmation -->
        <div *ngIf="leavingGroup" class="leave-confirm">
            <p>{{ 'groups.confirmLeave' | translate }}</p>
            <div class="button-row">
                <button (click)="leaveGroup()" [disabled]="loadingLeaveGroup" class="btn-leave-group btn-small">
                    {{ loadingLeaveGroup ? ('auth.loading' | translate) : ('groups.leaveGroup' | translate) }}
                </button>
                <button (click)="cancelLeaveGroup()" class="btn-secondary btn-small">
                    {{ 'groups.cancel' | translate }}
                </button>
            </div>
        </div>
    </div>

    <div class="content-grid">
        <div class="leaderboard-section" [class.collapsed]="!isLeaderboardExpanded">
            <div class="leaderboard-header" (click)="toggleLeaderboard()">
                <div class="leaderboard-title-wrapper">
                    <svg class="collapse-chevron" [class.expanded]="isLeaderboardExpanded"
                        xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                    <h2>{{ 'groups.leaderboard' | translate }}</h2>
                    <span class="member-count-badge" *ngIf="!isLeaderboardExpanded">({{ leaderboard.length }})</span>
                </div>
                <button class="btn-trash-talk" (click)="openTrashTalkInput(); $event.stopPropagation()"
                    [title]="'groups.trashTalk' | translate">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span *ngIf="getCurrentUserTrashTalk()" class="has-message-dot"></span>
                </button>
            </div>
            <div class="leaderboard-content" [class.expanded]="isLeaderboardExpanded">
                <div class="leaderboard-content-inner">
                    <!-- Trash Talk Input Dialog -->
                    <div *ngIf="showTrashTalkInput" class="trash-talk-dialog">
                        <div class="trash-talk-header">
                            <h4>{{ 'groups.trashTalkTitle' | translate }}</h4>
                            <button class="btn-close-trash" (click)="closeTrashTalkInput()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <p class="trash-talk-desc">{{ 'groups.trashTalkDesc' | translate }}</p>

                        <!-- Preview bubble -->
                        <div class="trash-talk-preview" *ngIf="trashTalkMessage">
                            <span class="preview-label">{{ 'groups.preview' | translate }}:</span>
                            <div class="trash-talk-bubble-preview"
                                [style.background]="trashTalkBgColor || 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'"
                                [style.color]="trashTalkTextColor || 'white'">
                                <img *ngIf="trashTalkTeamLogo" [src]="trashTalkTeamLogo" class="bubble-team-logo"
                                    alt="">
                                <span>{{ trashTalkMessage }}</span>
                            </div>
                        </div>

                        <input type="text" [(ngModel)]="trashTalkMessage"
                            [placeholder]="'groups.trashTalkPlaceholder' | translate" maxlength="40"
                            class="trash-talk-input" [disabled]="loadingTrashTalk">

                        <!-- Team logo selector -->
                        <div class="team-selector">
                            <span class="team-selector-label">{{ 'groups.selectTeam' | translate }}:</span>
                            <div class="team-grid">
                                <button *ngFor="let team of teamLogos" class="team-option"
                                    [class.selected]="trashTalkTeamLogo === team.logo"
                                    (click)="selectTrashTalkTeam(team)" [title]="team.name">
                                    <img [src]="team.logo" [alt]="team.name" class="team-option-logo">
                                </button>
                                <button class="team-option team-option-none" [class.selected]="!trashTalkTeamLogo"
                                    (click)="clearTrashTalkTeam()" [title]="'groups.noTeam' | translate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Background color selector -->
                        <div class="color-selector">
                            <span class="color-selector-label">{{ 'groups.selectColor' | translate }}:</span>
                            <div class="color-grid">
                                <button *ngFor="let color of colorPalette" class="color-option"
                                    [class.selected]="trashTalkBgColor === color" [style.backgroundColor]="color"
                                    (click)="selectTrashTalkColor(color)">
                                </button>
                                <button class="color-option color-option-none" [class.selected]="!trashTalkBgColor"
                                    (click)="clearTrashTalkColor()" [title]="'groups.noColor' | translate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Text color selector -->
                        <div class="color-selector">
                            <span class="color-selector-label">{{ 'groups.selectTextColor' | translate }}:</span>
                            <div class="color-grid">
                                <button *ngFor="let color of colorPalette" class="color-option"
                                    [class.selected]="trashTalkTextColor === color" [style.backgroundColor]="color"
                                    (click)="selectTrashTalkTextColor(color)">
                                </button>
                                <button class="color-option color-option-none" [class.selected]="!trashTalkTextColor"
                                    (click)="clearTrashTalkTextColor()" [title]="'groups.noColor' | translate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="trash-talk-footer">
                            <span class="char-count">{{ trashTalkMessage.length }}/40</span>
                            <div class="trash-talk-actions">
                                <button class="btn-secondary btn-small" (click)="closeTrashTalkInput()">{{
                                    'groups.cancel' | translate }}
                                </button>
                                <button class="btn-primary btn-small" (click)="submitTrashTalk()"
                                    [disabled]="loadingTrashTalk">
                                    {{ loadingTrashTalk ? ('auth.loading' | translate) : ('common.save' | translate) }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="loadingLeaderboard" class="loading">{{ 'auth.loading' | translate }}</div>
                    <div *ngIf="!loadingLeaderboard && leaderboard.length > 0" class="leaderboard">
                        <div *ngFor="let member of leaderboard; let i = index" class="leaderboard-item"
                            [class.winner]="isWinner(member)" [class.eliminated]="isEliminated(member)">
                            <span class="rank">{{ i + 1 }}</span>
                            <div class="profile-picture-wrapper" (click)="openProfilePicture(member.user)">
                                <img *ngIf="member.user.profilePicture"
                                    [src]="getProfilePictureUrl(member.user.profilePicture)" alt=""
                                    class="leaderboard-profile-picture" (error)="onProfileImageError($event)" />
                                <span *ngIf="!member.user.profilePicture" class="leaderboard-profile-placeholder">
                                    {{ member.user.username.charAt(0).toUpperCase() }}
                                </span>
                                <span class="online-indicator"
                                    [class.online]="isUserOnline(member.user.lastActive)"></span>
                            </div>
                            <span class="username-wrapper">
                                <span class="trash-talk-bubble"
                                    *ngIf="member.trashTalk?.message && isTrashTalkVisible(member.user._id)"
                                    [style.background]="member.trashTalk?.bgColor || null"
                                    [style.color]="member.trashTalk?.textColor || null"
                                    [style.--bubble-color]="member.trashTalk?.bgColor || '#d97706'">
                                    <img *ngIf="member.trashTalk?.teamLogo" [src]="member.trashTalk?.teamLogo"
                                        class="bubble-team-logo" alt="">
                                    {{ member.trashTalk?.message }}
                                </span>
                                <span class="username">
                                    {{ member.user.username }}
                                    <span *ngIf="isWinner(member)" class="trophy">üèÜ</span>
                                    <span *ngIf="isEliminated(member)" class="status-label">({{ 'groups.eliminated' |
                                        translate }})</span>
                                </span>
                                <button *ngIf="member.trashTalk?.message" class="btn-show-trash-talk"
                                    (click)="showTrashTalkManual(member.user._id); $event.stopPropagation()"
                                    [disabled]="isTrashTalkVisible(member.user._id)"
                                    [title]="'groups.showMessage' | translate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                </button>
                            </span>
                            <span class="points">
                                {{ member.points | number:'1.0-1' }}
                            </span>
                            <button *ngIf="canManageGroup() && !isGroupCreatorMember(member.user._id)"
                                (click)="confirmKickMember(member.user._id)" class="btn-kick"
                                [title]="'groups.kickMember' | translate">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <!-- Kick confirmation -->
                        <div *ngIf="kickingMemberId" class="kick-confirm">
                            <p>{{ 'groups.confirmKick' | translate }}</p>
                            <div class="button-row">
                                <button (click)="kickMember(kickingMemberId)" [disabled]="loadingKickMember"
                                    class="btn-delete-group btn-small">
                                    {{ loadingKickMember ? ('auth.loading' | translate) : ('groups.kick' | translate) }}
                                </button>
                                <button (click)="cancelKickMember()" class="btn-secondary btn-small">
                                    {{ 'groups.cancel' | translate }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!loadingLeaderboard && leaderboard.length === 0" class="empty-state">
                        {{ 'groups.noMembers' | translate }}
                    </div>

                    <!-- Pending Members in Leaderboard (shown to admin/creator) -->
                    <div *ngIf="canManageGroup() && pendingMembers.length > 0" class="pending-in-leaderboard">
                        <div *ngFor="let pending of pendingMembers" class="leaderboard-item pending">
                            <span class="rank">-</span>
                            <div class="profile-picture-wrapper" (click)="openProfilePicture(pending.user)">
                                <img *ngIf="pending.user.profilePicture"
                                    [src]="getProfilePictureUrl(pending.user.profilePicture)" alt=""
                                    class="leaderboard-profile-picture" (error)="onProfileImageError($event)" />
                                <span *ngIf="!pending.user.profilePicture" class="leaderboard-profile-placeholder">
                                    {{ pending.user.username.charAt(0).toUpperCase() }}
                                </span>
                                <span class="online-indicator"
                                    [class.online]="isUserOnline(pending.user.lastActive)"></span>
                            </div>
                            <span class="username">
                                {{ pending.user.username }}
                            </span>
                            <div class="pending-actions">
                                <button (click)="approveMember(pending.user._id)" class="btn-approve"
                                    [title]="'groups.approve' | translate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                </button>
                                <button (click)="rejectMember(pending.user._id)" class="btn-reject"
                                    [title]="'groups.reject' | translate">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="matches-section">
            <div class="section-header">
                <h2>{{ 'groups.matches' | translate }} <span class="match-count">({{ filteredMatches.length }})</span>
                </h2>
                <div class="header-actions">
                    <label class="save-filter-checkbox" [title]="'filters.saveFiltersTooltip' | translate">
                        <input type="checkbox" [(ngModel)]="saveFiltersEnabled" (change)="onSaveFiltersToggle()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                    </label>
                    <button (click)="openFilterDialog()" class="btn-filter" [class.has-filters]="hasActiveFilters()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                        </svg>
                        {{ 'filters.filter' | translate }}
                        <span *ngIf="hasActiveFilters()" class="filter-count">{{ getActiveFilterCount() }}</span>
                    </button>
                    <button *ngIf="canManageGroup() && !isAutomaticGroup()" [routerLink]="['/matches/manage']"
                        [queryParams]="{groupId: groupId}" class="btn-manage">
                        {{ 'matches.manageMatches' | translate }}
                    </button>
                </div>
            </div>

            <!-- Filter Dialog Overlay -->
            <div *ngIf="showFilterDialog" class="filter-overlay" (click)="closeFilterDialog()">
                <div class="filter-dialog" (click)="$event.stopPropagation()">
                    <div class="filter-header">
                        <h3>{{ 'filters.filterMatches' | translate }}</h3>
                        <button (click)="closeFilterDialog()" class="btn-close-filter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>

                    <div class="filter-body">
                        <!-- Status Filter -->
                        <div class="filter-section">
                            <label class="filter-label">{{ 'filters.matchStatus' | translate }}</label>
                            <div class="checkbox-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" [(ngModel)]="filters.showFinished">
                                    <span>{{ 'filters.finished' | translate }}</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" [(ngModel)]="filters.showNotStarted">
                                    <span>{{ 'filters.notStarted' | translate }}</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" [(ngModel)]="filters.showOngoing">
                                    <span>{{ 'filters.ongoing' | translate }}</span>
                                </label>
                            </div>
                        </div>

                        <!-- Date Range Filter -->
                        <div class="filter-section">
                            <label class="filter-label">{{ 'filters.dateRange' | translate }}</label>
                            <div class="date-range">
                                <div class="date-input-group">
                                    <label class="date-label">{{ 'filters.from' | translate }}</label>
                                    <input type="date" [(ngModel)]="filters.dateFrom" class="form-control date-input"
                                        [class.date-empty]="!filters.dateFrom"
                                        [attr.data-placeholder]="'filters.insertDate' | translate">
                                </div>
                                <span class="date-separator">-</span>
                                <div class="date-input-group">
                                    <label class="date-label">{{ 'filters.to' | translate }}</label>
                                    <input type="date" [(ngModel)]="filters.dateTo" class="form-control date-input"
                                        [class.date-empty]="!filters.dateTo"
                                        [attr.data-placeholder]="'filters.insertDate' | translate">
                                </div>
                            </div>
                        </div>

                        <!-- Members Who Betted Filter -->
                        <div class="filter-section">
                            <label class="filter-label">{{ 'filters.membersBetted' | translate }}</label>
                            <app-select [options]="memberSelectOptions" [(ngModel)]="filters.selectedMembers"
                                [multiple]="true" placeholder="Select members" placeholderHe="◊ë◊ó◊® ◊û◊©◊™◊û◊©◊ô◊ù"
                                selectedText="selected" selectedTextHe="◊†◊ë◊ó◊®◊ï">
                            </app-select>
                        </div>

                        <!-- Teams Filter -->
                        <div class="filter-section">
                            <label class="filter-label">{{ 'filters.teams' | translate }}</label>
                            <app-select [options]="teamSelectOptions" [(ngModel)]="filters.selectedTeams"
                                [multiple]="true" [searchable]="true" placeholder="Select teams"
                                placeholderHe="◊ë◊ó◊® ◊ß◊ë◊ï◊¶◊ï◊™" searchPlaceholder="Search teams..."
                                searchPlaceholderHe="◊ó◊ô◊§◊ï◊© ◊ß◊ë◊ï◊¶◊ï◊™..." selectedText="selected" selectedTextHe="◊†◊ë◊ó◊®◊ï">
                            </app-select>
                        </div>

                        <!-- Score Filter (for finished matches) -->
                        <div class="filter-section">
                            <label class="filter-label">{{ 'filters.score' | translate }}</label>
                            <div class="score-filter">
                                <div class="score-input-group">
                                    <label>{{ 'filters.homeScore' | translate }}</label>
                                    <input type="number" [(ngModel)]="filters.homeScore" min="0"
                                        class="form-control score-input" [placeholder]="'filters.any' | translate">
                                </div>
                                <span class="score-separator">-</span>
                                <div class="score-input-group">
                                    <label>{{ 'filters.awayScore' | translate }}</label>
                                    <input type="number" [(ngModel)]="filters.awayScore" min="0"
                                        class="form-control score-input" [placeholder]="'filters.any' | translate">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-footer">
                        <button (click)="clearFilters()" class="btn-secondary">{{ 'filters.clearAll' | translate }}
                        </button>
                        <button (click)="applyFilters()" class="btn-primary">{{ 'filters.apply' | translate }}</button>
                    </div>
                </div>
            </div>
            <div *ngIf="loadingMatches" class="loading">{{ 'auth.loading' | translate }}</div>

            <!-- Automatic groups: Show matches grouped by round -->
            <div *ngIf="!loadingMatches && filteredMatches.length > 0 && isAutomaticGroup() && matchesByRound.length > 0"
                class="matches-list matches-by-round">
                <!-- Load future rounds button (top - loads newer/higher round numbers) -->
                <button *ngIf="hasMoreFutureRounds" class="btn-load-rounds btn-load-future"
                    (click)="loadFutureRounds()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                    {{ 'matches.loadFutureRounds' | translate }}
                </button>

                <div *ngFor="let roundGroup of matchesByRound" class="round-group">
                    <div class="round-separator">
                        <div class="round-separator-left">
                            <span class="round-dates">{{ formatRoundDateRange(roundGroup.startDate, roundGroup.endDate)
                                }}</span>
                            <button class="btn-sticky-standings" [class.visible]="isRoundStuck && isAutomaticGroup()"
                                [class.active]="showStandings" (click)="toggleStandings(); $event.stopPropagation()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <line x1="18" y1="20" x2="18" y2="10"></line>
                                    <line x1="12" y1="20" x2="12" y2="4"></line>
                                    <line x1="6" y1="20" x2="6" y2="14"></line>
                                </svg>
                                <span>{{ 'standings.leagueTable' | translate }}</span>
                            </button>
                        </div>
                        <span class="round-name">{{ 'matches.round' | translate }} {{ roundGroup.roundNumber }}</span>
                    </div>
                    <div class="round-matches">
                        <div *ngFor="let dateGroup of roundGroup.dateGroups" class="date-group">
                            <div class="date-separator-sticky">
                                <span class="date-label">{{ formatMatchDate(dateGroup.date) }}</span>
                            </div>
                            <app-match-card *ngFor="let match of dateGroup.matches" [match]="match" [context]="matchCardContext"
                                [expandedMatchId]="expandedMatchId" [showBettingSection]="true" [showBetIndicators]="true"
                                matchIdField="_id"></app-match-card>
                        </div>
                    </div>
                </div>

                <!-- Load previous rounds button (bottom - loads older/lower round numbers) -->
                <button *ngIf="hasMorePastRounds" class="btn-load-rounds btn-load-previous"
                    (click)="loadPreviousRounds()">
                    {{ 'matches.loadPreviousRounds' | translate }}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Manual groups or no rounds: Show flat list -->
            <div *ngIf="!loadingMatches && filteredMatches.length > 0 && (!isAutomaticGroup() || matchesByRound.length === 0)"
                class="matches-list">
                <app-match-card *ngFor="let match of filteredMatches" [match]="match" [context]="matchCardContext"
                    [expandedMatchId]="expandedMatchId" [showBettingSection]="true" [showBetIndicators]="true"
                    matchIdField="_id"></app-match-card>
            </div>
            <div *ngIf="!loadingMatches && filteredMatches.length === 0" class="empty-state">
                {{ hasActiveFilters() ? ('filters.noMatchesFound' | translate) : ('groups.noMatches' | translate) }}
            </div>
        </div>
    </div>

    <!-- Profile Picture Modal -->
    <div *ngIf="viewingProfilePicture" class="profile-picture-modal" (click)="closeProfilePicture()">
        <div class="profile-picture-modal-content" (click)="$event.stopPropagation()">
            <button class="close-modal-btn" (click)="closeProfilePicture()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <img *ngIf="viewingProfilePicture.profilePicture"
                [src]="getProfilePictureUrl(viewingProfilePicture.profilePicture)"
                [alt]="viewingProfilePicture.username" class="modal-profile-picture" />
            <div *ngIf="!viewingProfilePicture.profilePicture" class="modal-profile-placeholder">
                {{ viewingProfilePicture.username.charAt(0).toUpperCase() }}
            </div>
            <div class="modal-username">
                {{ viewingProfilePicture.username }}
                <span class="modal-online-status" [class.online]="isUserOnline(viewingProfilePicture.lastActive)">
                    {{ isUserOnline(viewingProfilePicture.lastActive) ? 'Online' : 'Offline' }}
                </span>
            </div>

            <!-- User Statistics -->
            <div class="user-statistics">
                <div *ngIf="loadingStatistics" class="stats-loading">
                    {{ 'auth.loading' | translate }}
                </div>

                <div *ngIf="!loadingStatistics && userStatistics" class="stats-content">
                    <!-- Group Stats -->
                    <div class="stats-section">
                        <h4 class="stats-title">{{ 'stats.groupStats' | translate }}</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value">{{ userStatistics.groupStats.totalBets }}</span>
                                <span class="stat-label">{{ 'stats.totalBets' | translate }}</span>
                            </div>
                            <div class="stat-item highlight">
                                <span class="stat-value">{{ userStatistics.groupStats.successRate }}%</span>
                                <span class="stat-label">{{ 'stats.successRate' | translate }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">{{ userStatistics.groupStats.correctPredictions }}
                                    /{{ userStatistics.groupStats.calculatedBets }}</span>
                                <span class="stat-label">{{ 'stats.correct' | translate }}</span>
                            </div>
                        </div>
                        <div class="stats-breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">1</span>
                                <span class="breakdown-value">{{ userStatistics.groupStats.correctByType.homeWins }}
                                    /{{ userStatistics.groupStats.predictions.homeWins }}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">X</span>
                                <span class="breakdown-value">{{ userStatistics.groupStats.correctByType.draws }}
                                    /{{ userStatistics.groupStats.predictions.draws }}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">2</span>
                                <span class="breakdown-value">{{ userStatistics.groupStats.correctByType.awayWins }}
                                    /{{ userStatistics.groupStats.predictions.awayWins }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Global Stats -->
                    <div class="stats-section global">
                        <h4 class="stats-title">{{ 'stats.globalStats' | translate }}</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-value">{{ userStatistics.globalStats.totalBets }}</span>
                                <span class="stat-label">{{ 'stats.totalBets' | translate }}</span>
                            </div>
                            <div class="stat-item highlight">
                                <span class="stat-value">{{ userStatistics.globalStats.successRate }}%</span>
                                <span class="stat-label">{{ 'stats.successRate' | translate }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">{{ userStatistics.groupsCount }}</span>
                                <span class="stat-label">{{ 'stats.groups' | translate }}</span>
                            </div>
                        </div>
                        <div class="stats-breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">1</span>
                                <span class="breakdown-value">{{ userStatistics.globalStats.correctByType.homeWins }}
                                    /{{ userStatistics.globalStats.predictions.homeWins }}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">X</span>
                                <span class="breakdown-value">{{ userStatistics.globalStats.correctByType.draws }}
                                    /{{ userStatistics.globalStats.predictions.draws }}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">2</span>
                                <span class="breakdown-value">{{ userStatistics.globalStats.correctByType.awayWins }}
                                    /{{ userStatistics.globalStats.predictions.awayWins }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Controls -->
                <div *ngIf="authService.isAdmin() && viewingProfilePicture && !loadingStatistics" class="admin-controls">
                    <h4 class="admin-controls-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        {{ 'admin.adjustments' | translate }}
                    </h4>

                    <!-- Points Adjustment -->
                    <div class="admin-control-row">
                        <div class="admin-control-header">
                            <span class="admin-control-label">{{ 'admin.points' | translate }}</span>
                            <span class="admin-control-current" *ngIf="!adminEditingPoints">{{ getMemberPoints(viewingProfilePicture._id) }}</span>
                        </div>
                        <div *ngIf="!adminEditingPoints" class="admin-control-actions">
                            <button class="btn-admin-edit" (click)="startEditingPoints()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                {{ 'common.edit' | translate }}
                            </button>
                        </div>
                        <div *ngIf="adminEditingPoints" class="admin-edit-form">
                            <input type="number" [(ngModel)]="adminPointsValue" class="admin-input"
                                step="any" [disabled]="loadingAdminAdjustment" />
                            <div class="admin-edit-buttons">
                                <button class="btn-admin-save" (click)="savePointsAdjustment()"
                                    [disabled]="loadingAdminAdjustment">
                                    {{ loadingAdminAdjustment ? '...' : ('common.save' | translate) }}
                                </button>
                                <button class="btn-admin-cancel" (click)="cancelEditingPoints()"
                                    [disabled]="loadingAdminAdjustment">
                                    {{ 'common.cancel' | translate }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Adjustment -->
                    <div class="admin-control-row">
                        <div class="admin-control-header">
                            <span class="admin-control-label">{{ 'admin.statsAdjustment' | translate }}</span>
                            <span class="admin-control-hint" *ngIf="!adminEditingStats && userStatistics?.statsAdjustment">
                                ({{ userStatistics!.statsAdjustment!.totalBets >= 0 ? '+' : '' }}{{ userStatistics!.statsAdjustment!.totalBets }} {{ 'stats.totalBets' | translate }},
                                {{ userStatistics!.statsAdjustment!.correctPredictions >= 0 ? '+' : '' }}{{ userStatistics!.statsAdjustment!.correctPredictions }} {{ 'stats.correct' | translate }})
                            </span>
                        </div>
                        <div *ngIf="!adminEditingStats" class="admin-control-actions">
                            <button class="btn-admin-edit" (click)="startEditingStats()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                {{ 'common.edit' | translate }}
                            </button>
                        </div>
                        <div *ngIf="adminEditingStats" class="admin-edit-form">
                            <div class="admin-stats-fields">
                                <div class="admin-stats-field">
                                    <label>{{ 'admin.betsAdjustment' | translate }}</label>
                                    <input type="number" [(ngModel)]="adminStatsTotalBets" class="admin-input"
                                        [disabled]="loadingAdminAdjustment" />
                                </div>
                                <div class="admin-stats-field">
                                    <label>{{ 'admin.winsAdjustment' | translate }}</label>
                                    <input type="number" [(ngModel)]="adminStatsCorrectPredictions" class="admin-input"
                                        [disabled]="loadingAdminAdjustment" />
                                </div>
                            </div>
                            <div class="admin-edit-buttons">
                                <button class="btn-admin-save" (click)="saveStatsAdjustment()"
                                    [disabled]="loadingAdminAdjustment">
                                    {{ loadingAdminAdjustment ? '...' : ('common.save' | translate) }}
                                </button>
                                <button class="btn-admin-cancel" (click)="cancelEditingStats()"
                                    [disabled]="loadingAdminAdjustment">
                                    {{ 'common.cancel' | translate }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>