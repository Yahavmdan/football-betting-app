<!-- Minimized button (fixed to side) -->
<button
  *ngIf="isMinimized && !isDialogOpen"
  class="feedback-minimized-btn"
  (click)="toggleDialog()"
  [attr.aria-label]="t('feedback.reportBug')">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
  </svg>
</button>

<!-- Floating button (main) -->
<button
  *ngIf="!isMinimized && !isDialogOpen"
  class="feedback-floating-btn"
  (click)="toggleDialog()"
  [attr.aria-label]="t('feedback.reportBug')">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
  </svg>
  <span class="btn-label">{{ t('feedback.reportBug') }}</span>
</button>

<!-- Dialog overlay -->
<div *ngIf="isDialogOpen" class="feedback-overlay" (click)="closeDialog()"></div>

<!-- Dialog -->
<div *ngIf="isDialogOpen" class="feedback-dialog">
  <div class="dialog-header">
    <h3>{{ t('feedback.title') }}</h3>
    <div class="header-actions">
      <button class="btn-minimize" (click)="minimize()" [attr.aria-label]="t('feedback.minimize')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
      <button class="btn-close" (click)="closeDialog()" [attr.aria-label]="t('bets.close')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <div class="dialog-body">
    <p class="dialog-description">{{ t('feedback.description') }}</p>

    <div class="form-group">
      <label for="feedback-message">{{ t('feedback.messageLabel') }}</label>
      <textarea
        id="feedback-message"
        [(ngModel)]="message"
        [placeholder]="t('feedback.messagePlaceholder')"
        rows="4"
        [disabled]="isSubmitting"
        class="feedback-textarea"></textarea>
    </div>

    <!-- Image upload section -->
    <div class="image-upload-section">
      <input
        #fileInput
        type="file"
        accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
        (change)="onFileSelected($event)"
        class="hidden-file-input">

      <div *ngIf="!imagePreview" class="image-upload-btn" (click)="triggerFileInput()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <circle cx="8.5" cy="8.5" r="1.5"></circle>
          <polyline points="21 15 16 10 5 21"></polyline>
        </svg>
        <span>{{ t('feedback.addImage') }}</span>
      </div>

      <div *ngIf="imagePreview" class="image-preview-container">
        <img [src]="imagePreview" alt="Preview" class="image-preview">
        <button type="button" class="btn-remove-image" (click)="clearImage()" [attr.aria-label]="t('profile.removePicture')">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <div *ngIf="successMessage" class="success-message">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
      {{ successMessage }}
    </div>

    <div *ngIf="errorMessage" class="error-message">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      {{ errorMessage }}
    </div>
  </div>

  <div class="dialog-footer">
    <button
      class="btn-cancel"
      (click)="closeDialog()"
      [disabled]="isSubmitting">
      {{ t('groups.cancel') }}
    </button>
    <button
      class="btn-submit"
      (click)="submitFeedback()"
      [disabled]="!message.trim() || isSubmitting">
      <span *ngIf="isSubmitting" class="spinner"></span>
      {{ isSubmitting ? t('feedback.sending') : t('feedback.send') }}
    </button>
  </div>
</div>
