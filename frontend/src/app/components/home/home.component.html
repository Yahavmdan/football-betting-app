<div class="home-container">
  <!-- Navigation Tabs -->
  <div class="dashboard-tabs">
    <a routerLink="/home" class="dashboard-tab active">
      <span>{{ 'nav.matches' | translate }}</span>
    </a>
    <a routerLink="/groups" class="dashboard-tab">
      <span>{{ 'nav.groups' | translate }}</span>
    </a>
  </div>

  <!-- Header -->
  <div class="home-header">
    <h1>{{ 'home.title' | translate }}</h1>
      <button routerLink="/preferences" class="btn-primary">
          {{ 'home.editPreferences' | translate }}
      </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
  </div>

  <!-- Empty State - No Preferences -->
  <div *ngIf="!loading && !hasPreferences" class="empty-state">
    <div class="empty-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" y1="21" x2="4" y2="14"></line>
        <line x1="4" y1="10" x2="4" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12" y2="3"></line>
        <line x1="20" y1="21" x2="20" y2="16"></line>
        <line x1="20" y1="12" x2="20" y2="3"></line>
        <line x1="1" y1="14" x2="7" y2="14"></line>
        <line x1="9" y1="8" x2="15" y2="8"></line>
        <line x1="17" y1="16" x2="23" y2="16"></line>
      </svg>
    </div>
    <h2>{{ 'home.noPreferences' | translate }}</h2>
    <a routerLink="/preferences" class="setup-btn-large">{{ 'home.setupNow' | translate }}</a>
  </div>

  <!-- Matches Content -->
  <div *ngIf="!loading && hasPreferences">
    <!-- Live Matches Section -->
    <div *ngIf="liveMatches.length > 0" class="live-section">
      <div class="section-header live-header">
        <span class="live-indicator"></span>
        <h2>{{ 'home.liveNow' | translate }}</h2>
        <button type="button" class="refresh-btn" (click)="refreshMatches()">
          {{ 'common.refresh' | translate }}
        </button>
      </div>
      <div class="matches-list">
        <div *ngFor="let match of liveMatches"
             class="match-card compact"
             [class.expanded]="expandedMatchId === match.externalApiId"
             [class.live]="match.status === 'LIVE'"
             [class.favorite-team]="match.isFavoriteTeam">
          <ng-container *ngTemplateOutlet="matchCardTemplate; context: { $implicit: match }"></ng-container>
        </div>
      </div>
    </div>

    <!-- League Sections -->
    <div *ngIf="leagueGroups.length > 0">
      <div *ngFor="let leagueGroup of leagueGroups" class="league-section" [class.collapsed]="leagueGroup.isCollapsed">
        <div class="league-header" (click)="toggleLeagueCollapse(leagueGroup)">
          <div class="league-logo-wrapper">
            <img *ngIf="leagueGroup.league.logo" [src]="leagueGroup.league.logo" [alt]="'leagues.' + leagueGroup.league.id | translate" class="league-logo">
          </div>
          <h3>{{ 'leagues.' + leagueGroup.league.id | translate }}</h3>
          <span class="match-count">{{ leagueGroup.matches.length }}</span>
          <span class="collapse-icon" [class.collapsed]="leagueGroup.isCollapsed">â–¼</span>
        </div>
        <div class="matches-list">
          <div class="matches-list-inner">
            <div *ngFor="let match of leagueGroup.matches"
                 class="match-card compact"
                 [class.expanded]="expandedMatchId === match.externalApiId"
                 [class.live]="match.status === 'LIVE'"
                 [class.favorite-team]="match.isFavoriteTeam">
              <ng-container *ngTemplateOutlet="matchCardTemplate; context: { $implicit: match }"></ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="leagueGroups.length === 0 && allMatches.length === 0" class="no-matches">
      <p>{{ 'home.noMatches' | translate }}</p>
    </div>
  </div>
</div>

<!-- Match Card Template -->
<ng-template #matchCardTemplate let-match>
  <!-- Compact view - always visible -->
  <div class="match-compact-row" (click)="toggleMatchExpand(match)">
    <div class="match-compact-teams">
      <div class="team-block">
        <img *ngIf="match.homeTeamLogo" [src]="match.homeTeamLogo"
             [alt]="match.homeTeam | teamTranslate" class="team-logo-small" (error)="onImageError($event)">
        <span class="team-name">{{ match.homeTeam | teamTranslate }}</span>
      </div>
      <div class="score-block">
        <ng-container *ngIf="match.status === 'FINISHED' || match.status === 'LIVE' || (match.result && match.result.homeScore !== null); else noScoreYet">
          <div class="score-row">
            <span class="score-inline">{{ match.result?.homeScore }}</span>
            <span class="vs-compact">-</span>
            <span class="score-inline">{{ match.result?.awayScore }}</span>
          </div>
          <span *ngIf="match.status !== 'LIVE' && match.status !== 'FINISHED'" class="time-under-score">{{ match.matchDate | date:'HH:mm' }}</span>
        </ng-container>
        <ng-template #noScoreYet>
          <span class="time-instead-score">{{ match.matchDate | date:'HH:mm' }}</span>
        </ng-template>
        <div class="score-status-row">
          <span class="status-compact" [class.finished]="match.status === 'FINISHED'"
                [class.started]="match.status === 'SCHEDULED' && isMatchInPast(match.matchDate)"
                [class.live]="match.status === 'LIVE'">
            <span *ngIf="match.status === 'LIVE'" class="live-indicator"></span>
            <ng-container *ngIf="match.status === 'LIVE'">
              <ng-container *ngIf="match.statusShort === 'HT'; else notHalfTime">
                <span class="live-time">{{ 'matches.halfTime' | translate }}</span>
              </ng-container>
              <ng-template #notHalfTime>
                <ng-container *ngIf="match.elapsed !== undefined && match.elapsed !== null; else liveNoTime">
                  <span class="live-time">{{ match.elapsed }}'</span>
                </ng-container>
                <ng-template #liveNoTime>{{ 'matches.live' | translate }}</ng-template>
              </ng-template>
            </ng-container>
            <ng-container *ngIf="match.status !== 'LIVE'">
              {{ (match.status === 'SCHEDULED' && isMatchInPast(match.matchDate)) ? ('matches.started' | translate) : ('matches.' + match.status.toLowerCase() | translate) }}
              <span *ngIf="match.status === 'SCHEDULED' || match.status === 'FINISHED'" class="status-date">{{ match.matchDate | date:'dd/MM' }}</span>
            </ng-container>
          </span>
        </div>
      </div>
      <div class="team-block">
        <img *ngIf="match.awayTeamLogo" [src]="match.awayTeamLogo"
             [alt]="match.awayTeam | teamTranslate" class="team-logo-small" (error)="onImageError($event)">
        <span class="team-name">{{ match.awayTeam | teamTranslate }}</span>
      </div>
    </div>
  </div>

  <!-- Expanded view -->
  <div class="match-expanded-wrapper" [class.expanded]="expandedMatchId === match.externalApiId">
    <div class="match-expanded-content">
      <!-- Team logo backgrounds -->
      <div class="match-bg-logos">
        <div class="bg-logo bg-logo-home" *ngIf="match.homeTeamLogo"
             [style.background-image]="'url(' + match.homeTeamLogo + ')'"></div>
        <div class="bg-logo bg-logo-away" *ngIf="match.awayTeamLogo"
             [style.background-image]="'url(' + match.awayTeamLogo + ')'"></div>
      </div>

      <!-- Match Details Tabs (only for live/finished matches with API data) -->
      <div class="match-details-tabs" *ngIf="match.externalApiId && (match.status === 'LIVE' || match.status === 'FINISHED')">
        <!-- Tab Headers -->
        <div class="tabs-header">
          <button class="tab-btn" [class.active]="activeMatchTab === 'events'"
                  (click)="selectMatchTab('events'); $event.stopPropagation()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            {{ 'matches.events' | translate }}
          </button>
          <button class="tab-btn" [class.active]="activeMatchTab === 'lineups'"
                  (click)="selectMatchTab('lineups'); $event.stopPropagation()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            {{ 'matches.lineups' | translate }}
          </button>
          <button class="tab-btn" [class.active]="activeMatchTab === 'statistics'"
                  (click)="selectMatchTab('statistics'); $event.stopPropagation()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            {{ 'matches.statistics' | translate }}
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tabs-content">
          <!-- Events Tab -->
          <div class="tab-panel" *ngIf="activeMatchTab === 'events'">
            <div *ngIf="loadingMatchEvents" class="section-loading">
              <div class="inline-spinner"></div>
            </div>
            <div *ngIf="!loadingMatchEvents && matchEvents.length === 0" class="events-empty">
              {{ 'matches.noEvents' | translate }}
            </div>
            <div *ngIf="!loadingMatchEvents && processedEvents.length > 0" class="events-timeline">
              <ng-container *ngFor="let item of processedEvents">
                <!-- HT / FT / KO Marker -->
                <div *ngIf="item.isMarker" class="timeline-marker-row">
                  <div class="timeline-side home-side"></div>
                  <div class="timeline-center marker-center">
                    <span class="marker-badge" [class.ht]="item.markerType === 'HT'"
                          [class.ft]="item.markerType === 'FT'" [class.kickoff]="item.markerType === 'KO'">
                      {{ item.markerType === 'HT' ? ('matches.halfTime' | translate) : (item.markerType === 'FT' ? ('matches.fullTime' | translate) : ('matches.kickOff' | translate)) }}
                      <span class="marker-time">{{ item.label }}</span>
                    </span>
                  </div>
                  <div class="timeline-side away-side"></div>
                </div>

                <!-- Event Row -->
                <div *ngIf="!item.isMarker && item.event" class="timeline-row"
                     [class.home-event]="item.event.team.id === match.homeTeamId"
                     [class.away-event]="item.event.team.id !== match.homeTeamId"
                     [class.goal-row]="item.event.type === 'Goal'">
                  <!-- Home side -->
                  <div class="timeline-side home-side">
                    <ng-container *ngIf="item.event.team.id === match.homeTeamId">
                      <!-- GOAL event -->
                      <div class="event-content goal" *ngIf="item.event.type === 'Goal'">
                        <div class="goal-icon-wrap">
                          <span class="goal-ball-emoji">&#9917;</span>
                          <div class="goal-ripple"></div>
                        </div>
                        <div class="event-info">
                          <span class="goal-label">{{ 'matches.goalLabel' | translate }}</span>
                          <span class="goal-scorer">{{ item.event.player?.name || '-' }}</span>
                          <span *ngIf="item.event.assist?.name" class="goal-assist">{{ 'matches.assistLabel' | translate }}: {{ item.event.assist?.name }}</span>
                        </div>
                      </div>
                      <!-- CARD event -->
                      <div class="event-content" *ngIf="item.event.type === 'Card'"
                           [class.card-yellow]="item.event.detail.includes('Yellow')"
                           [class.card-red]="item.event.detail.includes('Red')">
                        <div class="event-icon">
                          <span *ngIf="item.event.detail.includes('Yellow')" class="card-icon yellow"></span>
                          <span *ngIf="item.event.detail.includes('Red')" class="card-icon red"></span>
                        </div>
                        <div class="event-info">
                          <span class="event-player">{{ item.event.player?.name || '-' }}</span>
                        </div>
                      </div>
                      <!-- SUBST event -->
                      <div class="event-content subst" *ngIf="item.event.type === 'Subst'">
                        <div class="subst-icon-wrap">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 4v6h6" stroke="#4ade80"/><path d="M23 20v-6h-6" stroke="#f87171"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10" stroke="#4ade80"/>
                            <path d="M3.51 15A9 9 0 0 0 18.36 18.36L23 14" stroke="#f87171"/>
                          </svg>
                        </div>
                        <div class="subst-players">
                          <div class="subst-player-row player-in" *ngIf="item.event.assist?.name">
                            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="3" stroke-linecap="round">
                              <path d="M5 12h14"/><path d="M12 5l7 7-7 7"/>
                            </svg>
                            <span class="subst-player-name">{{ item.event.assist?.name }}</span>
                          </div>
                          <div class="subst-player-row player-out">
                            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="3" stroke-linecap="round">
                              <path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/>
                            </svg>
                            <span class="subst-player-name">{{ item.event.player?.name }}</span>
                          </div>
                        </div>
                      </div>
                      <!-- VAR event -->
                      <div class="event-content var" *ngIf="item.event.type === 'Var'">
                        <div class="event-icon"><span class="var-badge">VAR</span></div>
                        <div class="event-info">
                          <span class="event-player">{{ item.event.player?.name || '-' }}</span>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                  <!-- Center time -->
                  <div class="timeline-center">
                    <span class="event-time" [class.goal-time]="item.event.type === 'Goal'">{{ item.event.time.elapsed }}<span *ngIf="item.event.time.extra">+{{ item.event.time.extra }}</span>'</span>
                  </div>
                  <!-- Away side -->
                  <div class="timeline-side away-side">
                    <ng-container *ngIf="item.event.team.id !== match.homeTeamId">
                      <!-- GOAL event -->
                      <div class="event-content goal" *ngIf="item.event.type === 'Goal'">
                        <div class="goal-icon-wrap">
                          <span class="goal-ball-emoji">&#9917;</span>
                          <div class="goal-ripple"></div>
                        </div>
                        <div class="event-info">
                          <span class="goal-label">{{ 'matches.goalLabel' | translate }}</span>
                          <span class="goal-scorer">{{ item.event.player?.name || '-' }}</span>
                          <span *ngIf="item.event.assist?.name" class="goal-assist">{{ 'matches.assistLabel' | translate }}: {{ item.event.assist?.name }}</span>
                        </div>
                      </div>
                      <!-- CARD event -->
                      <div class="event-content" *ngIf="item.event.type === 'Card'"
                           [class.card-yellow]="item.event.detail.includes('Yellow')"
                           [class.card-red]="item.event.detail.includes('Red')">
                        <div class="event-icon">
                          <span *ngIf="item.event.detail.includes('Yellow')" class="card-icon yellow"></span>
                          <span *ngIf="item.event.detail.includes('Red')" class="card-icon red"></span>
                        </div>
                        <div class="event-info">
                          <span class="event-player">{{ item.event.player?.name || '-' }}</span>
                        </div>
                      </div>
                      <!-- SUBST event -->
                      <div class="event-content subst" *ngIf="item.event.type === 'Subst'">
                        <div class="subst-icon-wrap">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 4v6h6" stroke="#4ade80"/><path d="M23 20v-6h-6" stroke="#f87171"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10" stroke="#4ade80"/>
                            <path d="M3.51 15A9 9 0 0 0 18.36 18.36L23 14" stroke="#f87171"/>
                          </svg>
                        </div>
                        <div class="subst-players">
                          <div class="subst-player-row player-in" *ngIf="item.event.assist?.name">
                            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="3" stroke-linecap="round">
                              <path d="M5 12h14"/><path d="M12 5l7 7-7 7"/>
                            </svg>
                            <span class="subst-player-name">{{ item.event.assist?.name }}</span>
                          </div>
                          <div class="subst-player-row player-out">
                            <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="#f87171" stroke-width="3" stroke-linecap="round">
                              <path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/>
                            </svg>
                            <span class="subst-player-name">{{ item.event.player?.name }}</span>
                          </div>
                        </div>
                      </div>
                      <!-- VAR event -->
                      <div class="event-content var" *ngIf="item.event.type === 'Var'">
                        <div class="event-icon"><span class="var-badge">VAR</span></div>
                        <div class="event-info">
                          <span class="event-player">{{ item.event.player?.name || '-' }}</span>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <!-- Lineups Tab -->
          <div class="tab-panel" *ngIf="activeMatchTab === 'lineups'">
            <div *ngIf="loadingMatchLineups" class="section-loading">
              <div class="inline-spinner"></div>
            </div>
            <div *ngIf="!loadingMatchLineups && matchLineups.length === 0" class="events-empty">
              {{ 'matches.noLineups' | translate }}
            </div>
            <div *ngIf="!loadingMatchLineups && matchLineups.length > 0" class="lineups-container">
              <!-- Football Pitch -->
              <div class="football-pitch">
                <!-- Pitch markings -->
                <div class="pitch-half home-half">
                  <div class="pitch-goal"></div>
                  <div class="pitch-box"></div>
                  <div class="pitch-box-small"></div>
                  <div class="pitch-arc"></div>
                </div>
                <div class="pitch-center-line"></div>
                <div class="pitch-center-circle"></div>
                <div class="pitch-half away-half">
                  <div class="pitch-goal"></div>
                  <div class="pitch-box"></div>
                  <div class="pitch-box-small"></div>
                  <div class="pitch-arc"></div>
                </div>

                <!-- Home Team (bottom half) -->
                <div class="pitch-team home-team" *ngIf="matchLineups[0]">
                  <div class="team-formation-label">
                    <img *ngIf="matchLineups[0].team.logo" [src]="matchLineups[0].team.logo" class="formation-team-logo" alt="">
                    <span>{{ matchLineups[0].formation }}</span>
                  </div>
                  <div *ngFor="let player of matchLineups[0].startXI"
                       class="pitch-player"
                       [style.--grid-row]="getPlayerRow(player?.grid, 0)"
                       [style.--grid-col]="getPlayerCol(player?.grid)"
                       [style.--total-cols]="getRowPlayerCount(matchLineups[0].startXI, player?.grid)">
                    <span class="pitch-player-number">{{ player.number }}</span>
                    <span class="pitch-player-name">{{ getShortName(player.name) }}</span>
                  </div>
                </div>

                <!-- Away Team (top half) -->
                <div class="pitch-team away-team" *ngIf="matchLineups[1]">
                  <div class="team-formation-label">
                    <img *ngIf="matchLineups[1].team.logo" [src]="matchLineups[1].team.logo" class="formation-team-logo" alt="">
                    <span>{{ matchLineups[1].formation }}</span>
                  </div>
                  <div *ngFor="let player of matchLineups[1].startXI"
                       class="pitch-player"
                       [style.--grid-row]="getPlayerRow(player?.grid, 1)"
                       [style.--grid-col]="getPlayerCol(player?.grid)"
                       [style.--total-cols]="getRowPlayerCount(matchLineups[1].startXI, player?.grid)">
                    <span class="pitch-player-number">{{ player.number }}</span>
                    <span class="pitch-player-name">{{ getShortName(player.name) }}</span>
                  </div>
                </div>
              </div>

              <!-- Substitutes -->
              <div class="substitutes-section" *ngIf="matchLineups.length > 0">
                <h5 class="subs-title">{{ 'matches.substitutes' | translate }}</h5>
                <div class="subs-grid">
                  <div class="subs-team" *ngIf="matchLineups[0]">
                    <div class="subs-team-header">
                      <img *ngIf="matchLineups[0].team.logo" [src]="matchLineups[0].team.logo" class="subs-team-logo" alt="">
                    </div>
                    <div class="subs-list">
                      <div *ngFor="let player of matchLineups[0].substitutes" class="sub-player">
                        <span class="sub-number">{{ player.number }}</span>
                        <span class="sub-name">{{ player.name }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="subs-team" *ngIf="matchLineups[1]">
                    <div class="subs-team-header">
                      <img *ngIf="matchLineups[1].team.logo" [src]="matchLineups[1].team.logo" class="subs-team-logo" alt="">
                    </div>
                    <div class="subs-list">
                      <div *ngFor="let player of matchLineups[1].substitutes" class="sub-player">
                        <span class="sub-number">{{ player.number }}</span>
                        <span class="sub-name">{{ player.name }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Statistics Tab -->
          <div class="tab-panel" *ngIf="activeMatchTab === 'statistics'">
            <div *ngIf="loadingMatchStatistics" class="section-loading">
              <div class="inline-spinner"></div>
            </div>
            <div *ngIf="!loadingMatchStatistics && matchStatistics.length === 0" class="events-empty">
              {{ 'matches.noStatistics' | translate }}
            </div>
            <div *ngIf="!loadingMatchStatistics && matchStatistics.length > 0" class="statistics-container">
              <div class="stats-header">
                <div class="stats-team home">
                  <img *ngIf="matchStatistics[0]?.team?.logo" [src]="matchStatistics[0]?.team?.logo" class="stats-team-logo" alt="">
                  <span>{{ matchStatistics[0]?.team?.name }}</span>
                </div>
                <div class="stats-team away">
                  <img *ngIf="matchStatistics[1]?.team?.logo" [src]="matchStatistics[1]?.team?.logo" class="stats-team-logo" alt="">
                  <span>{{ matchStatistics[1]?.team?.name }}</span>
                </div>
              </div>
              <div class="stats-list">
                <ng-container *ngFor="let stat of matchStatistics[0]?.statistics || []">
                  <div class="stat-row">
                    <div class="stat-value home">{{ getStatValue(matchStatistics, 0, stat.type) }}</div>
                    <div class="stat-bar-wrapper">
                      <div class="stat-bar-side home-side">
                        <div class="stat-bar home" [style.width.%]="getStatPercentage(matchStatistics, 0, stat.type)"></div>
                      </div>
                      <div class="stat-bar-side away-side">
                        <div class="stat-bar away" [style.width.%]="getStatPercentage(matchStatistics, 1, stat.type)"></div>
                      </div>
                    </div>
                    <div class="stat-value away">{{ getStatValue(matchStatistics, 1, stat.type) }}</div>
                  </div>
                  <div class="stat-label-row">{{ translateStatName(stat.type) }}</div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Head-to-Head History -->
      <div class="head-to-head-section">
        <h4 class="h2h-title collapsible-header" (click)="toggleHeadToHead(); $event.stopPropagation()">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="2" y1="2" x2="10" y2="10"></line>
            <polyline points="6 10 10 10 10 6"></polyline>
            <line x1="22" y1="22" x2="14" y2="14"></line>
            <polyline points="18 14 14 14 14 18"></polyline>
          </svg>
          <span>{{ 'matches.headToHead' | translate }}</span>
          <svg class="collapse-arrow" [class.open]="showHeadToHead" xmlns="http://www.w3.org/2000/svg"
               width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </h4>
        <div class="collapsible-content" [class.open]="showHeadToHead">
          <div *ngIf="loadingHeadToHead" class="section-loading">
            <div class="inline-spinner"></div>
          </div>
          <div *ngIf="!loadingHeadToHead && headToHeadMatches.length === 0" class="h2h-empty">
            {{ 'matches.noHeadToHead' | translate }}
          </div>
          <div *ngIf="!loadingHeadToHead && headToHeadMatches.length > 0" class="h2h-list">
            <div *ngFor="let h2hMatch of headToHeadMatches" class="h2h-item">
              <span class="h2h-date">{{ h2hMatch.matchDate | date:'dd/MM/yy' }}</span>
              <div class="h2h-teams">
                <span class="h2h-team" [class.winner]="(h2hMatch.result?.homeScore ?? 0) > (h2hMatch.result?.awayScore ?? 0)">{{ h2hMatch.homeTeam | teamTranslate }}</span>
                <span class="h2h-score">{{ h2hMatch.result?.homeScore }} - {{ h2hMatch.result?.awayScore }}</span>
                <span class="h2h-team" [class.winner]="(h2hMatch.result?.awayScore ?? 0) > (h2hMatch.result?.homeScore ?? 0)">{{ h2hMatch.awayTeam | teamTranslate }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Team Form Section -->
      <div class="team-form-section" *ngIf="currentExpandedMatch">
        <h4 class="team-form-title collapsible-header" (click)="toggleTeamForm(); $event.stopPropagation()">
          <svg class="section-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span>{{ 'matches.teamForm' | translate }}</span>
          <svg class="collapse-arrow" [class.open]="showTeamForm" xmlns="http://www.w3.org/2000/svg"
               width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </h4>
        <div class="collapsible-content" [class.open]="showTeamForm">
          <div *ngIf="loadingTeamForm" class="section-loading">
            <div class="inline-spinner"></div>
          </div>
          <div *ngIf="!loadingTeamForm" class="team-form-container">
            <!-- Home Team Form -->
            <div class="team-form-column">
              <div class="team-form-header">
                <img *ngIf="currentExpandedMatch.homeTeamLogo" [src]="currentExpandedMatch.homeTeamLogo" class="team-form-logo" (error)="onImageError($event)">
                <span class="team-form-name">{{ currentExpandedMatch.homeTeam | teamTranslate }}</span>
              </div>
              <div *ngIf="homeTeamRecentMatches.length === 0" class="team-form-empty">
                {{ 'matches.noRecentMatches' | translate }}
              </div>
              <div *ngIf="homeTeamRecentMatches.length > 0" class="team-form-results">
                <span *ngFor="let formMatch of homeTeamRecentMatches"
                      class="form-result"
                      [class.win]="getTeamResult(formMatch, currentExpandedMatch.homeTeam) === 'W'"
                      [class.draw]="getTeamResult(formMatch, currentExpandedMatch.homeTeam) === 'D'"
                      [class.loss]="getTeamResult(formMatch, currentExpandedMatch.homeTeam) === 'L'"
                      [title]="(formMatch.homeTeam | teamTranslate) + ' ' + formMatch.result?.homeScore + '-' + formMatch.result?.awayScore + ' ' + (formMatch.awayTeam | teamTranslate)">
                  {{ getTeamResult(formMatch, currentExpandedMatch.homeTeam) }}
                </span>
              </div>
            </div>
            <!-- Away Team Form -->
            <div class="team-form-column">
              <div class="team-form-header">
                <img *ngIf="currentExpandedMatch.awayTeamLogo" [src]="currentExpandedMatch.awayTeamLogo" class="team-form-logo" (error)="onImageError($event)">
                <span class="team-form-name">{{ currentExpandedMatch.awayTeam | teamTranslate }}</span>
              </div>
              <div *ngIf="awayTeamRecentMatches.length === 0" class="team-form-empty">
                {{ 'matches.noRecentMatches' | translate }}
              </div>
              <div *ngIf="awayTeamRecentMatches.length > 0" class="team-form-results">
                <span *ngFor="let formMatch of awayTeamRecentMatches"
                      class="form-result"
                      [class.win]="getTeamResult(formMatch, currentExpandedMatch.awayTeam) === 'W'"
                      [class.draw]="getTeamResult(formMatch, currentExpandedMatch.awayTeam) === 'D'"
                      [class.loss]="getTeamResult(formMatch, currentExpandedMatch.awayTeam) === 'L'"
                      [title]="(formMatch.homeTeam | teamTranslate) + ' ' + formMatch.result?.homeScore + '-' + formMatch.result?.awayScore + ' ' + (formMatch.awayTeam | teamTranslate)">
                  {{ getTeamResult(formMatch, currentExpandedMatch.awayTeam) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
