<div class="home-container">
  <app-dashboard-tabs activeTab="matches"></app-dashboard-tabs>

  <!-- Header -->
  <div class="home-header">
    <h1>{{ 'home.title' | translate }}</h1>
      <button routerLink="/preferences" class="btn-primary">
          {{ 'home.editPreferences' | translate }}
      </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
  </div>

  <!-- Empty State - No Preferences -->
  <div *ngIf="!loading && !hasPreferences" class="empty-state">
    <div class="empty-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" y1="21" x2="4" y2="14"></line>
        <line x1="4" y1="10" x2="4" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12" y2="3"></line>
        <line x1="20" y1="21" x2="20" y2="16"></line>
        <line x1="20" y1="12" x2="20" y2="3"></line>
        <line x1="1" y1="14" x2="7" y2="14"></line>
        <line x1="9" y1="8" x2="15" y2="8"></line>
        <line x1="17" y1="16" x2="23" y2="16"></line>
      </svg>
    </div>
    <h2>{{ 'home.noPreferences' | translate }}</h2>
    <a routerLink="/preferences" class="setup-btn-large">{{ 'home.setupNow' | translate }}</a>
  </div>

  <!-- Matches Content -->
  <div *ngIf="!loading && hasPreferences">
    <!-- Live Matches Section -->
    <div *ngIf="liveMatches.length > 0" class="live-section">
      <div class="section-header live-header">
        <span class="live-indicator"></span>
        <h2>{{ 'home.liveNow' | translate }}</h2>
        <button type="button" class="refresh-btn" (click)="refreshMatches()">
          {{ 'common.refresh' | translate }}
        </button>
      </div>
      <div class="matches-list">
        <app-match-card *ngFor="let match of liveMatches" [match]="match" [context]="matchCardContext"
          [expandedMatchId]="expandedMatchId" [showBettingSection]="false" [showBetIndicators]="false"
          matchIdField="externalApiId"></app-match-card>
      </div>
    </div>

    <!-- League Sections -->
    <div *ngIf="leagueGroups.length > 0">
      <div *ngFor="let leagueGroup of leagueGroups" class="league-section" [class.collapsed]="leagueGroup.isCollapsed">
        <div class="league-header" (click)="toggleLeagueCollapse(leagueGroup)">
          <div class="league-logo-wrapper">
            <img *ngIf="leagueGroup.league.logo" [src]="leagueGroup.league.logo" [alt]="'leagues.' + leagueGroup.league.id | translate" class="league-logo">
          </div>
          <h3>{{ 'leagues.' + leagueGroup.league.id | translate }}</h3>
          <button class="btn-standings-toggle" [class.active]="activeStandingsLeague === leagueGroup"
            (click)="toggleLeagueStandings(leagueGroup, $event)"
            [title]="'standings.leagueTable' | translate">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
            </svg>
          </button>
          <span class="match-count">{{ leagueGroup.matches.length }}</span>
          <span class="collapse-icon" [class.collapsed]="leagueGroup.isCollapsed">â–¼</span>
        </div>

        <div class="matches-list">
          <div class="matches-list-inner">
            <app-match-card *ngFor="let match of leagueGroup.matches" [match]="match" [context]="matchCardContext"
              [expandedMatchId]="expandedMatchId" [showBettingSection]="false" [showBetIndicators]="false"
              matchIdField="externalApiId"></app-match-card>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="leagueGroups.length === 0 && allMatches.length === 0" class="no-matches">
      <p>{{ 'home.noMatches' | translate }}</p>
    </div>
  </div>

  <!-- League Standings Modal Overlay -->
  <div *ngIf="activeStandingsLeague" class="standings-overlay" (click)="closeStandings()">
    <div class="standings-modal" (click)="$event.stopPropagation()">
      <div class="standings-header">
        <div class="standings-title">
          <img *ngIf="activeStandingsLeague.league.logo" [src]="activeStandingsLeague.league.logo"
            class="standings-league-logo" alt="">
          <h3>{{ 'leagues.' + activeStandingsLeague.league.id | translate }}</h3>
          <span *ngIf="activeStandingsLeague.standings?.league?.season" class="season-badge">
            {{ activeStandingsLeague.standings?.league?.season }}/{{ (activeStandingsLeague.standings?.league?.season || 0) + 1 }}
          </span>
        </div>
        <button class="btn-close-standings" (click)="closeStandings()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div *ngIf="activeStandingsLeague.loadingStandings" class="standings-loading">
        <div class="inline-spinner"></div>
      </div>

      <div *ngIf="!activeStandingsLeague.loadingStandings && !activeStandingsLeague.standings" class="standings-error">
        {{ 'standings.loadError' | translate }}
      </div>

      <div *ngIf="!activeStandingsLeague.loadingStandings && activeStandingsLeague.standings" class="standings-table-wrapper">
        <table class="standings-table">
          <thead>
            <tr>
              <th class="col-rank">#</th>
              <th class="col-team">{{ 'standings.team' | translate }}</th>
              <th class="col-played">{{ 'standings.played' | translate }}</th>
              <th class="col-won">{{ 'standings.won' | translate }}</th>
              <th class="col-drawn">{{ 'standings.drawn' | translate }}</th>
              <th class="col-lost">{{ 'standings.lost' | translate }}</th>
              <th class="col-gf">{{ 'standings.gf' | translate }}</th>
              <th class="col-ga">{{ 'standings.ga' | translate }}</th>
              <th class="col-gd">{{ 'standings.gd' | translate }}</th>
              <th class="col-points">{{ 'standings.pts' | translate }}</th>
              <th class="col-form">{{ 'standings.form' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let team of activeStandingsLeague.standings.standings"
              [class.champions-league]="team.description?.includes('Champions')"
              [class.europa-league]="team.description?.includes('Europa') || team.description?.includes('Confederation')"
              [class.relegation]="team.description?.includes('Relegation')">
              <td class="col-rank">{{ team.rank }}</td>
              <td class="col-team">
                <img [src]="team.team.logo" [alt]="team.team.name | teamTranslate" class="team-logo-tiny">
                <span class="team-name-standings">{{ team.team.name | teamTranslate }}</span>
              </td>
              <td class="col-played">{{ team.played }}</td>
              <td class="col-won">{{ team.won }}</td>
              <td class="col-drawn">{{ team.drawn }}</td>
              <td class="col-lost">{{ team.lost }}</td>
              <td class="col-gf">{{ team.goalsFor }}</td>
              <td class="col-ga">{{ team.goalsAgainst }}</td>
              <td class="col-gd" [class.positive]="team.goalsDiff > 0" [class.negative]="team.goalsDiff < 0">
                {{ team.goalsDiff > 0 ? '+' : '' }}{{ team.goalsDiff }}
              </td>
              <td class="col-points"><strong>{{ team.points }}</strong></td>
              <td class="col-form">
                <div class="form-badges">
                  <span *ngFor="let result of team.form.split('')" class="form-badge"
                    [class.win]="result === 'W'" [class.draw]="result === 'D'"
                    [class.loss]="result === 'L'">{{ result }}</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
